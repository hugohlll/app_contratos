<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Consulta Militar - SISCONT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
    </style>
</head>

<body class="bg-light d-flex flex-column min-vh-100">

    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="{% url 'pesquisa' %}">:: SISCONT ::</a>
        </div>
    </nav>

    <div class="container mt-4 mb-4">
        <div class="text-center mb-4">
            <h2><i class="bi bi-person-badge me-2"></i>Minhas Comiss√µes</h2>
            <p class="text-muted mb-0">Consulte seu hist√≥rico de designa√ß√µes e portarias.</p>
        </div>

        <div class="row justify-content-center mb-4">
            <div class="col-md-8 col-lg-6">
                <form action="" method="get" class="d-flex shadow-sm">
                    <input name="q" class="form-control form-control-lg border-0 rounded-start" type="search"
                        placeholder="Digite seu SARAM ou Nome de Guerra..." value="{{ query|default:'' }}"
                        aria-label="Search" required style="border: 1px solid #ced4da;">
                    <button class="btn btn-primary fw-bold border-0 rounded-end px-4" type="submit">
                        Consultar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="container mb-5 flex-grow-1">
        {% if integrantes %}
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4>Resultados para "<span class="text-primary">{{ query }}</span>"</h4>

            <a href="{% url 'exportar_historico_militar_csv' %}?q={{ query }}" class="btn btn-outline-primary">
                <i class="bi bi-file-earmark-excel me-2"></i>Baixar Hist√≥rico Completo
            </a>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-primary">
                            <tr>
                                <th>Militar</th>
                                <th>Fun√ß√£o</th>
                                <th>Contrato</th>
                                <th>Per√≠odo Designa√ß√£o</th>
                                <th>Portaria</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in integrantes %}
                            <tr>
                                <td>
                                    <div class="fw-bold">
                                        {% if item.posto_graduacao %}
                                        {{ item.posto_graduacao.sigla }} {{ item.agente.nome_de_guerra }}
                                        {% else %}
                                        {{ item.agente.posto.sigla }} {{ item.agente.nome_de_guerra }}
                                        {% endif %}
                                    </div>
                                    <small class="text-muted">SARAM: {{ item.agente.saram }}</small>
                                </td>
                                <td>{{ item.funcao.titulo }}</td>
                                <td>
                                    <a href="{% url 'detalhe_contrato' item.comissao.contrato.id %}"
                                        class="text-decoration-none fw-bold">
                                        {{ item.comissao.contrato.numero }}
                                    </a>
                                    <div class="small text-muted text-truncate" style="max-width: 250px;">
                                        {{ item.comissao.contrato.empresa.razao_social }}
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex flex-column">
                                        <span><strong>In√≠cio:</strong> {{ item.data_inicio|date:"d/m/Y" }}</span>
                                        {% if item.data_desligamento %}
                                        <span class="text-danger small">Saiu em: {{ item.data_desligamento|date:"d/m/Y" }}</span>
                                        {% elif item.data_fim %}
                                        <span class="text-muted small">Previsto at√©: {{ item.data_fim|date:"d/m/Y" }}</span>
                                        {% else %}
                                        <span class="text-success small">Ativa</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <div>N¬∫ {{ item.portaria_numero }}</div>
                                    <small class="text-muted">de {{ item.portaria_data|date:"d/m/Y" }}</small>
                                </td>
                                <td>
                                    {% if item.is_ativo %}
                                    <span class="badge bg-success">ATIVO</span>
                                    {% else %}
                                    <span class="badge bg-secondary">ENCERRADO</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        {% elif query %}
        <div class="text-center py-5">
            <div class="display-1 text-muted opacity-25 mb-3">ü§∑‚Äç‚ôÇÔ∏è</div>
            <h3 class="text-muted">Nenhum registro encontrado.</h3>
            <p class="text-muted">Verifique se digitou corretamente o SARAM ou Nome de Guerra.</p>
        </div>
        {% endif %}
    </div>

    <footer class="bg-primary text-white text-center py-4 mt-auto">
    </footer>

</body>

</html>