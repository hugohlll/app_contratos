<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Consulta Militar - SISCONT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #198754 0%, #157347 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'pesquisa' %}">üèõÔ∏è SISCONT</a>
            
            <div class="ms-auto d-flex align-items-center">
                 <a href="{% url 'pesquisa' %}" class="btn btn-outline-light btn-sm me-2">
                    üîç Volta para Pesquisa de Contratos
                </a>
            </div>
        </div>
    </nav>
    
    <div class="hero-section text-center">
        <div class="container">
            <h1 class="display-5 fw-bold mb-3">Minhas Comiss√µes</h1>
            <p class="lead mb-4">Consulte seu hist√≥rico de designa√ß√µes e portarias.</p>
            
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <form action="" method="get" class="d-flex shadow-sm">
                        <input name="q" class="form-control form-control-lg border-0 rounded-start" type="search" placeholder="Digite seu SARAM ou Nome de Guerra..." value="{{ query|default:'' }}" aria-label="Search" required> 
                        <button class="btn btn-light text-success fw-bold border-0 rounded-end px-4" type="submit">
                            Consultar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        {% if integrantes %}
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4>Resultados para "<span class="text-success">{{ query }}</span>"</h4>
            
            <a href="{% url 'exportar_historico_militar_csv' %}?q={{ query }}" class="btn btn-outline-success">
                <i class="bi bi-file-earmark-excel me-2"></i>Baixar Hist√≥rico Completo
            </a>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-success">
                            <tr>
                                <th>Militar</th>
                                <th>Fun√ß√£o</th>
                                <th>Contrato</th>
                                <th>Per√≠odo Designa√ß√£o</th>
                                <th>Portaria</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in integrantes %}
                            <tr>
                                <td>
                                    <div class="fw-bold">
                                    {% if item.posto_graduacao %}
                                        {{ item.posto_graduacao.sigla }} {{ item.agente.nome_de_guerra }}
                                    {% else %}
                                        {{ item.agente.posto.sigla }} {{ item.agente.nome_de_guerra }}
                                    {% endif %}
                                    </div>
                                    <small class="text-muted">SARAM: {{ item.agente.saram }}</small>
                                </td>
                                <td>{{ item.funcao.titulo }}</td>
                                <td>
                                    <a href="{% url 'detalhe_contrato' item.comissao.contrato.id %}" class="text-decoration-none fw-bold">
                                        {{ item.comissao.contrato.numero }}
                                    </a>
                                    <div class="small text-muted text-truncate" style="max-width: 250px;">
                                        {{ item.comissao.contrato.empresa.razao_social }}
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex flex-column">
                                        <span><strong>In√≠cio:</strong> {{ item.data_inicio|date:"d/m/Y" }}</span>
                                        {% if item.data_desligamento %}
                                        <span class="text-danger small">Saiu em: {{ item.data_desligamento|date:"d/m/Y" }}</span>
                                        {% elif item.data_fim %}
                                        <span class="text-muted small">Previsto at√©: {{ item.data_fim|date:"d/m/Y" }}</span>
                                        {% else %}
                                        <span class="text-success small">Ativa</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    <div>N¬∫ {{ item.portaria_numero }}</div>
                                    <small class="text-muted">de {{ item.portaria_data|date:"d/m/Y" }}</small>
                                </td>
                                <td>
                                    {% if item.is_ativo %}
                                    <span class="badge bg-success">ATIVO</span>
                                    {% else %}
                                    <span class="badge bg-secondary">ENCERRADO</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        {% elif query %}
        <div class="text-center py-5">
            <div class="display-1 text-muted opacity-25 mb-3">ü§∑‚Äç‚ôÇÔ∏è</div>
            <h3 class="text-muted">Nenhum registro encontrado.</h3>
            <p class="text-muted">Verifique se digitou corretamente o SARAM ou Nome de Guerra.</p>
        </div>
        {% endif %}
    </div>

</body>
</html>
